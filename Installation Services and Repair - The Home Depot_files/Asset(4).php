(void 0===window.QSI.EmbeddedTarget||window.QTest)&&(QSI.EmbeddedTarget=QSI.util.Class({initialize:function(a,b,c){this.parent=c,this.options=b||{},this.url=a,this.width=this.options.targetWidth,this.height=this.options.targetHeight;var d=QSI.util.getPageSize(),e=d.width,f=d.height;this.width>e&&(this.width=e-30),this.height>f&&(this.height=f-30),this.popup(),void 0===QSI.reg[this.parent.id].embeddedWindows&&(QSI.reg[this.parent.id].embeddedWindows=[]),QSI.reg[this.parent.id].embeddedWindows.push({targetIframe:this.targetIframe,container:this.container});var g=this;this.options.autoCloseTarget&&QSI.util.observe(window,"message",function(a){"closeQSIWindow"==a.data&&g.close()}),QSI.util.isAndroid()&&this.formatForAndroid()},formatForAndroid:function(){document.body.style.overflow="visible";var a=document.querySelector(".QSIEmbeddedTarget");a.style.position="absolute",this.scrollElementIntoMidViewport(a);var b=window.innerHeight,c=window.innerWidth,d=this;window.addEventListener("resize",function(){var e=window.innerHeight;e>b&&e!==c&&d.scrollElementIntoMidViewport(a),b=e})},scrollElementIntoMidViewport:function(a){var b=a.getBoundingClientRect().left,c=window.innerWidth/2,d=a.offsetWidth/2,e=b-c+d,f=a.getBoundingClientRect().top,g=window.innerHeight/2,h=a.offsetHeight/2,i=f-g+h;window.scrollBy(e,i)},clipPageToFitWithinViewport:function(){var a=document.documentElement.style.position,b=document.documentElement.style.width;document.documentElement.style.position="fixed",document.documentElement.style.width="100%",this.unclipPageFromViewport=function(){document.documentElement.style.position=a,document.documentElement.style.width=b}},resetStyles:function(){var a=this.options.resetStyle,b=QSI.util.build("style",{type:"text/css"},a);document.body.appendChild(b),QSI.util.addToStyleElements(b)},close:function(){try{QSI.util.remove(this.container),QSI.util.remove(this.shadowBox),QSI.util.startScrolling(),"iOS"===QSI.OS.name&&this.unclipPageFromViewport()}catch(a){QSI.dbg.e(a)}},popup:function(){try{this.container=this.build(),document.body.appendChild(this.container),this.shadowBox=this.buildShadowBox(),QSI.util.stopScrolling(),"iOS"===QSI.OS.name&&this.clipPageToFitWithinViewport(),document.body.appendChild(this.shadowBox),this.container.style.zIndex=QSI.global.currentZIndex++;var a=this.width,b=this.height,c=QSI.util.getScrollOffsets(),d=QSI.util.getPageSize(),e=d.width,f=d.height,g=(e-a)/2,h=(f-b)/2;QSI.util.isFixed()||(g+=c.left,h+=c.top),this.container.style.zoom=1,this.container.style.left=g+"px",this.container.style.top=h+"px"}catch(i){QSI.dbg.e(i)}},build:function(){var a=[this.buildContainer()],b="fixed";return QSI.util.isFixed()||(b="absolute"),QSI.util.build("div",{className:"QSIEmbeddedTarget",style:{position:b}},a)},buildCloseButtonElement:function(){var a=QSI.util.build("img",{src:QSI.global.imagePath+"/siteintercept/bwc_close.png",style:{cursor:"pointer",position:"absolute",top:"-15px",right:"-15px",zIndex:QSI.global.currentZIndex++},alt:"Close"}),b=this;return a.onclick=function(){b.onCloseClick()},a},buildContainer:function(){var a={};a.style={};var b=0,c=0,d=3;a.style={top:b+"px",left:c+"px",position:"absolute",zIndex:QSI.global.currentZIndex++,width:this.width+"px",height:this.height+"px",backgroundColor:"#ffffff",border:d+"px solid #333333",borderRadius:d+"px",mozBorderRadius:d+"px",boxShadow:"0px 0px 10px 0px rgba(0,0,0,0.7)"};var e=QSI.util.build("div",a);this.targetIframe=this.buildTargetIframe(),this.targetIframe.style.display="none";var f=this.buildWaiter(),g=this,h=function(){g.targetIframe.style.display="block",f.style.display="none"};QSI.util.observe(this.targetIframe,"load",h),this.targetIframe.src=this.url,e.appendChild(f),e.appendChild(QSI.util.build("div",{style:{width:this.width+"px",height:this.height+"px",overflow:"auto","-webkit-overflow-scrolling":"touch"}},[this.targetIframe])),e.appendChild(this.buildCloseButtonElement());var i=QSI.util.getDimensions(e);return e.bc={x:c+i.width,y:b+i.height},e},buildWaiter:function(){return QSI.util.build("img",{src:QSI.global.imagePath+"/ajax-loading.gif",style:{position:"absolute",top:this.height/2-10+"px",left:this.width/2-110+"px"},alt:""})},onCloseClick:function(){this.close()},buildIFrame:function(a,b){var c=QSI.util.build("iframe",{style:{border:"none",position:"absolute",top:0,left:0,filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},width:a+"px",height:b+"px",frameBorder:"0",src:QSI.global.imagePath+"/blank.html"});return c},buildTargetIframe:function(){var a=QSI.util.build("iframe",{width:"100%",height:"100%",frameBorder:"0"});return a},buildShadowBox:function(){var a=1,b="transparent",c=QSI.util.getPageSize(),d=c.width,e=c.height,f=QSI.util.getScrollOffsets();return QSI.util.build("div",{className:"QSIEmbeddedWindowShadowBox",style:{position:"absolute",backgroundColor:b,left:f.left+"px",top:f.top+"px",width:d+"px",height:e+"px",opacity:a,zIndex:QSI.global.currentZIndex++,filter:"alpha(opacity="+100*a+")"}})}}));
